"use strict";exports.id=539,exports.ids=[539],exports.modules={28539:(t,e,i)=>{i.d(e,{TransactionFactory:()=>O});var r,s,a=i(84177),o=i(77161),n=i(86590);(function(t){t[t.EIP155ReplayProtection=155]="EIP155ReplayProtection",t[t.EIP1559FeeMarket=1559]="EIP1559FeeMarket",t[t.EIP2718TypedTransaction=2718]="EIP2718TypedTransaction",t[t.EIP2930AccessLists=2930]="EIP2930AccessLists",t[t.EIP7702EOACode=7702]="EIP7702EOACode"})(r||(r={})),function(t){t[t.Legacy=0]="Legacy",t[t.AccessListEIP2930=1]="AccessListEIP2930",t[t.FeeMarketEIP1559=2]="FeeMarketEIP1559",t[t.BlobEIP4844=3]="BlobEIP4844",t[t.EOACodeEIP7702=4]="EOACodeEIP7702"}(s||(s={}));class h{static getAccessListData(t){let e,i;if(0===t.length||Array.isArray(t[0])){i=t??[];let r=[];for(let t=0;t<i.length;t++){let e=i[t],s=(0,o.ci)(e[0]),a=[];for(let t=0;t<e[1].length;t++)a.push((0,o.ci)(e[1][t]));let n={address:s,storageKeys:a};r.push(n)}e=r}else{e=t;let r=[];for(let e=0;e<t.length;e++){let i=t[e],s=(0,o.nr)(i.address),a=[];for(let t=0;t<i.storageKeys.length;t++)a.push((0,o.nr)(i.storageKeys[t]));r.push([s,a])}i=r}return{AccessListJSON:e,accessList:i}}static verifyAccessList(t){for(let e=0;e<t.length;e++){let i=t[e],r=i[0],s=i[1];if(void 0!==i[2])throw Error("Access list item cannot have 3 elements. It can only have an address, and an array of storage slots.");if(20!==r.length)throw Error("Invalid EIP-2930 transaction: address length should be 20 bytes");for(let t=0;t<s.length;t++)if(32!==s[t].length)throw Error("Invalid EIP-2930 transaction: storage slot length should be 32 bytes")}}static getAccessListJSON(t){let e=[];for(let i=0;i<t.length;i++){let r=t[i],s={address:(0,o.ci)((0,o.V_)(r[0],20)),storageKeys:[]},a=r[1];for(let t=0;t<a.length;t++){let e=a[t];s.storageKeys.push((0,o.ci)((0,o.V_)(e,32)))}e.push(s)}return e}static getDataFeeEIP2930(t,e){let i=e.param("gasPrices","accessListStorageKeyCost"),r=e.param("gasPrices","accessListAddressCost"),s=0;for(let e=0;e<t.length;e++)s+=t[e][1].length;return t.length*Number(r)+s*Number(i)}}class c{static getAuthorizationListData(t){let e,i;if(0===t.length||Array.isArray(t[0])){i=t??[];let r=[];for(let t=0;t<i.length;t++){let e=i[t],s=(0,o.ci)(e[0]),a=(0,o.ci)(e[1]),n=e[2],h=[];for(let t=0;t<n.length;t++)h.push((0,o.ci)(n[t]));let c={chainId:s,address:a,nonce:h,yParity:(0,o.ci)(e[3]),r:(0,o.ci)(e[4]),s:(0,o.ci)(e[5])};r.push(c)}e=r}else{e=t;let r=[],s=["chainId","address","nonce","yParity","r","s"];for(let e=0;e<t.length;e++){let i=t[e];for(let t of s)if(void 0===i[t])throw Error(`EIP-7702 authorization list invalid: ${t} is not defined`);let a=(0,o.nr)(i.chainId),n=(0,o.nr)(i.address),h=[];for(let t=0;t<i.nonce.length;t++)h.push((0,o.nr)(i.nonce[t]));let c=(0,o.nr)(i.yParity),m=(0,o.nr)(i.r),d=(0,o.nr)(i.s);r.push([a,n,h,c,m,d])}i=r}return{AuthorizationListJSON:e,authorizationList:i}}static verifyAuthorizationList(t){for(let e=0;e<t.length;e++){let i=t[e],r=i[1],s=i[2],a=i[3],n=i[4],h=i[5];if((0,o.jY)({yParity:a,r:n,s:h}),20!==r.length)throw Error("Invalid EIP-7702 transaction: address length should be 20 bytes");if(s.length>1)throw Error("Invalid EIP-7702 transaction: nonce list should consist of at most 1 item");1===s.length&&(0,o.jY)({nonce:s[0]})}}static getDataFeeEIP7702(t,e){let i=e.param("gasPrices","perAuthBaseCost");return t.length*Number(i)}}function m(t){return(0,o.nr)(`0x${t.toString(16).padStart(2,"0")}`)}class d{constructor(t,e){this.cache={hash:void 0,dataFee:void 0,senderPubKey:void 0},this.activeCapabilities=[],this.DEFAULT_CHAIN=n.qo.Mainnet;let{nonce:i,gasLimit:r,to:s,value:a,data:h,v:c,r:m,s:d,type:l}=t;this._type=Number((0,o.v3)((0,o.O0)(l))),this.txOptions=e;let g=(0,o.O0)(""===s?"0x":s),u=(0,o.O0)(c),v=(0,o.O0)(m),P=(0,o.O0)(d);this.nonce=(0,o.v3)((0,o.O0)(i)),this.gasLimit=(0,o.v3)((0,o.O0)(r)),this.to=g.length>0?new o.kL(g):void 0,this.value=(0,o.v3)((0,o.O0)(a)),this.data=(0,o.O0)(""===h?"0x":h),this.v=u.length>0?(0,o.v3)(u):void 0,this.r=v.length>0?(0,o.v3)(v):void 0,this.s=P.length>0?(0,o.v3)(P):void 0,this._validateCannotExceedMaxInteger({value:this.value,r:this.r,s:this.s}),this._validateCannotExceedMaxInteger({gasLimit:this.gasLimit},64),this._validateCannotExceedMaxInteger({nonce:this.nonce},64,!0);let f=void 0===this.to||null===this.to,y=e.allowUnlimitedInitCodeSize??!1,b=e.common??this._getCommon();f&&b.isActivatedEIP(3860)&&!1===y&&function(t,e){let i=t.param("vm","maxInitCodeSize");if(i&&BigInt(e)>i)throw Error(`the initcode size of this transaction is too large: it is ${e} while the max is ${t.param("vm","maxInitCodeSize")}`)}(b,this.data.length)}get type(){return this._type}supports(t){return this.activeCapabilities.includes(t)}getValidationErrors(){let t=[];return this.isSigned()&&!this.verifySignature()&&t.push("Invalid Signature"),this.getBaseFee()>this.gasLimit&&t.push(`gasLimit is too low. given ${this.gasLimit}, need at least ${this.getBaseFee()}`),t}isValid(){return 0===this.getValidationErrors().length}getBaseFee(){let t=this.common.param("gasPrices","tx"),e=this.getDataFee();if(t&&(e+=t),this.common.gteHardfork("homestead")&&this.toCreationAddress()){let t=this.common.param("gasPrices","txCreation");t&&(e+=t)}return e}getDataFee(){let t=this.common.param("gasPrices","txDataZero"),e=this.common.param("gasPrices","txDataNonZero"),i=o.N$;for(let r=0;r<this.data.length;r++)0===this.data[r]?i+=t:i+=e;if((void 0===this.to||null===this.to)&&this.common.isActivatedEIP(3860)){let t=BigInt(Math.ceil(this.data.length/32));i+=this.common.param("gasPrices","initCodeWordCost")*t}return i}toCreationAddress(){return void 0===this.to||0===this.to.bytes.length}isSigned(){let{v:t,r:e,s:i}=this;return void 0!==t&&void 0!==e&&void 0!==i}verifySignature(){try{let t=this.getSenderPublicKey();return 0!==(0,o._K)(t).length}catch(t){return!1}}getSenderAddress(){return new o.kL((0,o.fB)(this.getSenderPublicKey()))}sign(t){if(32!==t.length)throw Error(this._errorMsg("Private key must be 32 bytes in length."));let e=!1;this.type===s.Legacy&&this.common.gteHardfork("spuriousDragon")&&!this.supports(r.EIP155ReplayProtection)&&(this.activeCapabilities.push(r.EIP155ReplayProtection),e=!0);let i=this.getHashedMessageToSign(),{v:a,r:n,s:h}=(this.common.customCrypto?.ecsign??o.v4)(i,t),c=this.addSignature(a,n,h,!0);if(e){let t=this.activeCapabilities.indexOf(r.EIP155ReplayProtection);t>-1&&this.activeCapabilities.splice(t,1)}return c}toJSON(){return{type:(0,o.Z4)(BigInt(this.type)),nonce:(0,o.Z4)(this.nonce),gasLimit:(0,o.Z4)(this.gasLimit),to:void 0!==this.to?this.to.toString():void 0,value:(0,o.Z4)(this.value),data:(0,o.ci)(this.data),v:void 0!==this.v?(0,o.Z4)(this.v):void 0,r:void 0!==this.r?(0,o.Z4)(this.r):void 0,s:void 0!==this.s?(0,o.Z4)(this.s):void 0}}_getCommon(t,e){if(void 0===e)return t?.copy()??new n.Common({chain:this.DEFAULT_CHAIN});{let i=(0,o.v3)((0,o.O0)(e));if(t){if(t.chainId()!==i)throw Error(this._errorMsg(`The chain ID does not match the chain ID of Common. Got: ${i}, expected: ${t.chainId()}`));return t.copy()}return n.Common.isSupportedChainId(i)?new n.Common({chain:i}):n.Common.custom({name:"custom-chain",networkId:i,chainId:i},{baseChain:this.DEFAULT_CHAIN})}}_validateCannotExceedMaxInteger(t,e=256,i=!1){for(let[r,s]of Object.entries(t))switch(e){case 64:if(i){if(void 0!==s&&s>=o.np)throw Error(this._errorMsg(`${r} cannot equal or exceed MAX_UINT64 (2^64-1), given ${s}`))}else if(void 0!==s&&s>o.np)throw Error(this._errorMsg(`${r} cannot exceed MAX_UINT64 (2^64-1), given ${s}`));break;case 256:if(i){if(void 0!==s&&s>=o.E2)throw Error(this._errorMsg(`${r} cannot equal or exceed MAX_INTEGER (2^256-1), given ${s}`))}else if(void 0!==s&&s>o.E2)throw Error(this._errorMsg(`${r} cannot exceed MAX_INTEGER (2^256-1), given ${s}`));break;default:throw Error(this._errorMsg("unimplemented bits value"))}}static _validateNotArray(t){let e=["nonce","gasPrice","gasLimit","to","value","data","v","r","s","type","baseFee","maxFeePerGas","chainId"];for(let[i,r]of Object.entries(t))if(e.includes(i)&&Array.isArray(r))throw Error(`${i} cannot be an array`)}_getSharedErrorPostfix(){let t="";try{t=this.isSigned()?(0,o.ci)(this.hash()):"not available (unsigned)"}catch(e){t="error"}let e="";try{e=this.isSigned().toString()}catch(e){t="error"}let i="";try{i=this.common.hardfork()}catch(t){i="error"}return`tx type=${this.type} hash=${t} nonce=${this.nonce} value=${this.value} signed=${e} hf=${i}`}}function l(t,e){let i=t.maxPriorityFeePerGas,r=t.maxFeePerGas-e;return t.gasLimit*((i<r?i:r)+e)+t.value}function g(t,e){if(void 0===e||e>t.maxFeePerGas)throw Error("Tx cannot pay baseFee");let i=t.maxFeePerGas-e;return t.maxPriorityFeePerGas<i?t.maxPriorityFeePerGas:i}var u=i(33874);function v(t,e){return`${e} (${t.errorStr()})`}function P(t,e){if(t.cache.dataFee&&t.cache.dataFee.hardfork===t.common.hardfork())return t.cache.dataFee.value;let i=d.prototype.getDataFee.bind(t)()+(e??0n);return Object.isFrozen(t)&&(t.cache.dataFee={value:i,hardfork:t.common.hardfork()}),i}function f(t){if(!t.isSigned())throw Error(v(t,"Cannot call hash method if transaction is not signed"));let e=t.common.customCrypto.keccak256??u.wn;return Object.isFrozen(t)?(t.cache.hash||(t.cache.hash=e(t.serialize())),t.cache.hash):e(t.serialize())}function y(t){let{s:e}=t;if(t.common.gteHardfork("homestead")&&void 0!==e&&e>o.Sr)throw Error(v(t,"Invalid Signature: s-values greater than secp256k1n/2 are considered invalid"))}function b(t){if(void 0!==t.cache.senderPubKey)return t.cache.senderPubKey;let e=t.getMessageToVerifySignature(),{v:i,r:s,s:a}=t;y(t);try{let n=(t.common.customCrypto.ecrecover??o.Js)(e,i,(0,o.XD)(s),(0,o.XD)(a),t.supports(r.EIP155ReplayProtection)?t.common.chainId():void 0);return Object.isFrozen(t)&&(t.cache.senderPubKey=n),n}catch(e){throw Error(v(t,"Invalid Signature"))}}function x(t,e){if(void 0!==e&&e>t)throw Error("Tx cannot pay baseFee");return void 0===e?t:t-e}function p(t){return(t.common.customCrypto.keccak256??u.wn)(t.getMessageToSign())}function E(t,e){return(0,o.eV)(m(t.type),a.yH.encode(e??t.raw()))}function I(t){let{v:e}=t;if(void 0!==e&&e!==o.N$&&e!==o.jm)throw Error(v(t,"The y-parity of the transaction should either be 0 or 1"))}function w(t){return P(t,BigInt(h.getDataFeeEIP2930(t.accessList,t.common)))}class A extends d{constructor(t,e={}){super({...t,type:s.FeeMarketEIP1559},e);let{chainId:i,accessList:r,maxFeePerGas:a,maxPriorityFeePerGas:n}=t;if(this.common=this._getCommon(e.common,i),this.chainId=this.common.chainId(),!this.common.isActivatedEIP(1559))throw Error("EIP-1559 not enabled on Common");this.activeCapabilities=this.activeCapabilities.concat([1559,2718,2930]);let c=h.getAccessListData(r??[]);if(this.accessList=c.accessList,this.AccessListJSON=c.AccessListJSON,h.verifyAccessList(this.accessList),this.maxFeePerGas=(0,o.v3)((0,o.O0)(a)),this.maxPriorityFeePerGas=(0,o.v3)((0,o.O0)(n)),this._validateCannotExceedMaxInteger({maxFeePerGas:this.maxFeePerGas,maxPriorityFeePerGas:this.maxPriorityFeePerGas}),d._validateNotArray(t),this.gasLimit*this.maxFeePerGas>o.E2)throw Error(this._errorMsg("gasLimit * maxFeePerGas cannot exceed MAX_INTEGER (2^256-1)"));if(this.maxFeePerGas<this.maxPriorityFeePerGas)throw Error(this._errorMsg("maxFeePerGas cannot be less than maxPriorityFeePerGas (The total must be the larger of the two)"));I(this),y(this),(e?.freeze??!0)&&Object.freeze(this)}static fromTxData(t,e={}){return new A(t,e)}static fromSerializedTx(t,e={}){if(!1===(0,o.hD)(t.subarray(0,1),m(s.FeeMarketEIP1559)))throw Error(`Invalid serialized tx input: not an EIP-1559 transaction (wrong tx type, expected: ${s.FeeMarketEIP1559}, received: ${(0,o.ci)(t.subarray(0,1))}`);let i=a.yH.decode(t.subarray(1));if(!Array.isArray(i))throw Error("Invalid serialized tx input: must be array");return A.fromValuesArray(i,e)}static fromValuesArray(t,e={}){if(9!==t.length&&12!==t.length)throw Error("Invalid EIP-1559 transaction. Only expecting 9 values (for unsigned tx) or 12 values (for signed tx).");let[i,r,s,a,n,h,c,m,d,l,g,u]=t;return this._validateNotArray({chainId:i,v:l}),(0,o.jY)({nonce:r,maxPriorityFeePerGas:s,maxFeePerGas:a,gasLimit:n,value:c,v:l,r:g,s:u}),new A({chainId:(0,o.v3)(i),nonce:r,maxPriorityFeePerGas:s,maxFeePerGas:a,gasLimit:n,to:h,value:c,data:m,accessList:d??[],v:void 0!==l?(0,o.v3)(l):void 0,r:g,s:u},e)}getDataFee(){return w(this)}getEffectivePriorityFee(t){return g(this,t)}getUpfrontCost(t=o.N$){return l(this,t)}raw(){return[(0,o.XD)(this.chainId),(0,o.XD)(this.nonce),(0,o.XD)(this.maxPriorityFeePerGas),(0,o.XD)(this.maxFeePerGas),(0,o.XD)(this.gasLimit),void 0!==this.to?this.to.bytes:new Uint8Array(0),(0,o.XD)(this.value),this.data,this.accessList,void 0!==this.v?(0,o.XD)(this.v):new Uint8Array(0),void 0!==this.r?(0,o.XD)(this.r):new Uint8Array(0),void 0!==this.s?(0,o.XD)(this.s):new Uint8Array(0)]}serialize(){return E(this)}getMessageToSign(){return E(this,this.raw().slice(0,9))}getHashedMessageToSign(){return p(this)}hash(){return f(this)}getMessageToVerifySignature(){return this.getHashedMessageToSign()}getSenderPublicKey(){return b(this)}addSignature(t,e,i,r=!1){e=(0,o.O0)(e),i=(0,o.O0)(i);let s={...this.txOptions,common:this.common};return A.fromTxData({chainId:this.chainId,nonce:this.nonce,maxPriorityFeePerGas:this.maxPriorityFeePerGas,maxFeePerGas:this.maxFeePerGas,gasLimit:this.gasLimit,to:this.to,value:this.value,data:this.data,accessList:this.accessList,v:r?t-o.Ym:t,r:(0,o.v3)(e),s:(0,o.v3)(i)},s)}toJSON(){let t=h.getAccessListJSON(this.accessList);return{...super.toJSON(),chainId:(0,o.Z4)(this.chainId),maxPriorityFeePerGas:(0,o.Z4)(this.maxPriorityFeePerGas),maxFeePerGas:(0,o.Z4)(this.maxFeePerGas),accessList:t}}errorStr(){return this._getSharedErrorPostfix()+` maxFeePerGas=${this.maxFeePerGas} maxPriorityFeePerGas=${this.maxPriorityFeePerGas}`}_errorMsg(t){return v(this,t)}}class F extends d{constructor(t,e={}){super({...t,type:s.AccessListEIP2930},e);let{chainId:i,accessList:r,gasPrice:a}=t;if(this.common=this._getCommon(e.common,i),this.chainId=this.common.chainId(),!this.common.isActivatedEIP(2930))throw Error("EIP-2930 not enabled on Common");this.activeCapabilities=this.activeCapabilities.concat([2718,2930]);let n=h.getAccessListData(r??[]);if(this.accessList=n.accessList,this.AccessListJSON=n.AccessListJSON,h.verifyAccessList(this.accessList),this.gasPrice=(0,o.v3)((0,o.O0)(a)),this._validateCannotExceedMaxInteger({gasPrice:this.gasPrice}),d._validateNotArray(t),this.gasPrice*this.gasLimit>o.E2)throw Error(this._errorMsg("gasLimit * gasPrice cannot exceed MAX_INTEGER"));I(this),y(this),(e?.freeze??!0)&&Object.freeze(this)}static fromTxData(t,e={}){return new F(t,e)}static fromSerializedTx(t,e={}){if(!1===(0,o.hD)(t.subarray(0,1),m(s.AccessListEIP2930)))throw Error(`Invalid serialized tx input: not an EIP-2930 transaction (wrong tx type, expected: ${s.AccessListEIP2930}, received: ${(0,o.ci)(t.subarray(0,1))}`);let i=a.yH.decode(Uint8Array.from(t.subarray(1)));if(!Array.isArray(i))throw Error("Invalid serialized tx input: must be array");return F.fromValuesArray(i,e)}static fromValuesArray(t,e={}){if(8!==t.length&&11!==t.length)throw Error("Invalid EIP-2930 transaction. Only expecting 8 values (for unsigned tx) or 11 values (for signed tx).");let[i,r,s,a,n,h,c,m,d,l,g]=t;return this._validateNotArray({chainId:i,v:d}),(0,o.jY)({nonce:r,gasPrice:s,gasLimit:a,value:h,v:d,r:l,s:g}),new F({chainId:(0,o.v3)(i),nonce:r,gasPrice:s,gasLimit:a,to:n,value:h,data:c,accessList:m??[],v:void 0!==d?(0,o.v3)(d):void 0,r:l,s:g},e)}getEffectivePriorityFee(t){return x(this.gasPrice,t)}getDataFee(){return w(this)}getUpfrontCost(){return this.gasLimit*this.gasPrice+this.value}raw(){return[(0,o.XD)(this.chainId),(0,o.XD)(this.nonce),(0,o.XD)(this.gasPrice),(0,o.XD)(this.gasLimit),void 0!==this.to?this.to.bytes:new Uint8Array(0),(0,o.XD)(this.value),this.data,this.accessList,void 0!==this.v?(0,o.XD)(this.v):new Uint8Array(0),void 0!==this.r?(0,o.XD)(this.r):new Uint8Array(0),void 0!==this.s?(0,o.XD)(this.s):new Uint8Array(0)]}serialize(){return E(this)}getMessageToSign(){return E(this,this.raw().slice(0,8))}getHashedMessageToSign(){return p(this)}hash(){return f(this)}getMessageToVerifySignature(){return this.getHashedMessageToSign()}getSenderPublicKey(){return b(this)}addSignature(t,e,i,r=!1){e=(0,o.O0)(e),i=(0,o.O0)(i);let s={...this.txOptions,common:this.common};return F.fromTxData({chainId:this.chainId,nonce:this.nonce,gasPrice:this.gasPrice,gasLimit:this.gasLimit,to:this.to,value:this.value,data:this.data,accessList:this.accessList,v:r?t-o.Ym:t,r:(0,o.v3)(e),s:(0,o.v3)(i)},s)}toJSON(){let t=h.getAccessListJSON(this.accessList);return{...super.toJSON(),chainId:(0,o.Z4)(this.chainId),gasPrice:(0,o.Z4)(this.gasPrice),accessList:t}}errorStr(){return this._getSharedErrorPostfix()+` gasPrice=${this.gasPrice} accessListCount=${this.accessList?.length??0}`}_errorMsg(t){return v(this,t)}}let L=(t,e,i,r,s,a)=>{let n;if(!(t.length===e.length&&e.length===i.length))throw Error("Number of blobVersionedHashes, blobs, and commitments not all equal");if(0===t.length)throw Error("Invalid transaction with empty blobs");try{n=a.verifyBlobKzgProofBatch(e,i,r)}catch(t){throw Error(`KZG verification of blobs fail with error=${t}`)}if(!n)throw Error("KZG proof cannot be verified from blobs/commitments");for(let e=0;e<t.length;e++){let r=(0,o.h$)(i[e],s);if(!(0,o.hD)(r,t[e]))throw Error(`commitment for blob at index ${e} does not match versionedHash`)}};class z extends d{constructor(t,e={}){super({...t,type:s.BlobEIP4844},e);let{chainId:i,accessList:r,maxFeePerGas:a,maxPriorityFeePerGas:n,maxFeePerBlobGas:c}=t;if(this.common=this._getCommon(e.common,i),this.chainId=this.common.chainId(),!this.common.isActivatedEIP(1559))throw Error("EIP-1559 not enabled on Common");if(!this.common.isActivatedEIP(4844))throw Error("EIP-4844 not enabled on Common");this.activeCapabilities=this.activeCapabilities.concat([1559,2718,2930]);let m=h.getAccessListData(r??[]);if(this.accessList=m.accessList,this.AccessListJSON=m.AccessListJSON,h.verifyAccessList(this.accessList),this.maxFeePerGas=(0,o.v3)((0,o.O0)(a)),this.maxPriorityFeePerGas=(0,o.v3)((0,o.O0)(n)),this._validateCannotExceedMaxInteger({maxFeePerGas:this.maxFeePerGas,maxPriorityFeePerGas:this.maxPriorityFeePerGas}),d._validateNotArray(t),this.gasLimit*this.maxFeePerGas>o.E2)throw Error(this._errorMsg("gasLimit * maxFeePerGas cannot exceed MAX_INTEGER (2^256-1)"));if(this.maxFeePerGas<this.maxPriorityFeePerGas)throw Error(this._errorMsg("maxFeePerGas cannot be less than maxPriorityFeePerGas (The total must be the larger of the two)"));for(let e of(this.maxFeePerBlobGas=(0,o.v3)((0,o.O0)((c??"")===""?"0x":c)),this.blobVersionedHashes=(t.blobVersionedHashes??[]).map(t=>(0,o.O0)(t)),I(this),y(this),this.blobVersionedHashes)){if(32!==e.length)throw Error(this._errorMsg("versioned hash is invalid length"));if(BigInt(e[0])!==this.common.param("sharding","blobCommitmentVersionKzg"))throw Error(this._errorMsg("versioned hash does not start with KZG commitment version"))}if(this.blobVersionedHashes.length>6)throw Error(this._errorMsg("tx can contain at most 6 blobs"));if(0===this.blobVersionedHashes.length)throw Error(this._errorMsg("tx should contain at least one blob"));if(void 0===this.to)throw Error(this._errorMsg('tx should have a "to" field and cannot be used to create contracts'));this.blobs=t.blobs?.map(t=>o.O0(t)),this.kzgCommitments=t.kzgCommitments?.map(t=>o.O0(t)),this.kzgProofs=t.kzgProofs?.map(t=>o.O0(t)),(e?.freeze??!0)&&Object.freeze(this)}static fromTxData(t,e){if(e?.common?.customCrypto?.kzg===void 0)throw Error("A common object with customCrypto.kzg initialized required to instantiate a 4844 blob tx");let i=e.common.customCrypto.kzg;if(void 0!==t.blobsData){if(void 0!==t.blobs)throw Error("cannot have both raw blobs data and encoded blobs in constructor");if(void 0!==t.kzgCommitments)throw Error("cannot have both raw blobs data and KZG commitments in constructor");if(void 0!==t.blobVersionedHashes)throw Error("cannot have both raw blobs data and versioned hashes in constructor");if(void 0!==t.kzgProofs)throw Error("cannot have both raw blobs data and KZG proofs in constructor");t.blobs=(0,o.KR)(t.blobsData.reduce((t,e)=>t+e)),t.kzgCommitments=(0,o.PS)(i,t.blobs),t.blobVersionedHashes=(0,o.CW)(t.kzgCommitments),t.kzgProofs=(0,o.y9)(i,t.blobs,t.kzgCommitments)}return new z(t,e)}getEffectivePriorityFee(t){return g(this,t)}static minimalFromNetworkWrapper(t,e){if(e?.common?.customCrypto?.kzg===void 0)throw Error("A common object with customCrypto.kzg initialized required to instantiate a 4844 blob tx");return z.fromTxData({...t,blobs:void 0,kzgCommitments:void 0,kzgProofs:void 0},e)}static fromSerializedTx(t,e={}){if(e.common?.customCrypto?.kzg===void 0)throw Error("A common object with customCrypto.kzg initialized required to instantiate a 4844 blob tx");if(!1===(0,o.hD)(t.subarray(0,1),m(s.BlobEIP4844)))throw Error(`Invalid serialized tx input: not an EIP-4844 transaction (wrong tx type, expected: ${s.BlobEIP4844}, received: ${(0,o.ci)(t.subarray(0,1))}`);let i=a.yH.decode(t.subarray(1));if(!Array.isArray(i))throw Error("Invalid serialized tx input: must be array");return z.fromValuesArray(i,e)}static fromValuesArray(t,e={}){if(e.common?.customCrypto?.kzg===void 0)throw Error("A common object with customCrypto.kzg initialized required to instantiate a 4844 blob tx");if(11!==t.length&&14!==t.length)throw Error("Invalid EIP-4844 transaction. Only expecting 11 values (for unsigned tx) or 14 values (for signed tx).");let[i,r,s,a,n,h,c,m,d,l,g,u,v,P]=t;return this._validateNotArray({chainId:i,v:u}),(0,o.jY)({nonce:r,maxPriorityFeePerGas:s,maxFeePerGas:a,gasLimit:n,value:c,maxFeePerBlobGas:l,v:u,r:v,s:P}),new z({chainId:(0,o.v3)(i),nonce:r,maxPriorityFeePerGas:s,maxFeePerGas:a,gasLimit:n,to:h,value:c,data:m,accessList:d??[],maxFeePerBlobGas:l,blobVersionedHashes:g,v:void 0!==u?(0,o.v3)(u):void 0,r:v,s:P},e)}static fromSerializedBlobTxNetworkWrapper(t,e){if(!e||!e.common)throw Error("common instance required to validate versioned hashes");if(e.common?.customCrypto?.kzg===void 0)throw Error("A common object with customCrypto.kzg initialized required to instantiate a 4844 blob tx");if(!1===(0,o.hD)(t.subarray(0,1),m(s.BlobEIP4844)))throw Error(`Invalid serialized tx input: not an EIP-4844 transaction (wrong tx type, expected: ${s.BlobEIP4844}, received: ${(0,o.ci)(t.subarray(0,1))}`);let i=a.yH.decode(t.subarray(1));if(4!==i.length)throw Error("Expected 4 values in the deserialized network transaction");let[r,n,h,c]=i,d=z.fromValuesArray(r,{...e,freeze:!1});if(void 0===d.to)throw Error("BlobEIP4844Transaction can not be send without a valid `to`");let l=Number(e.common.param("sharding","blobCommitmentVersionKzg"));return L(d.blobVersionedHashes,n,h,c,l,e.common.customCrypto.kzg),d.blobs=n,d.kzgCommitments=h,d.kzgProofs=c,(e?.freeze??!0)&&Object.freeze(d),d}getDataFee(){return w(this)}getUpfrontCost(t=o.N$){return l(this,t)}raw(){return[(0,o.XD)(this.chainId),(0,o.XD)(this.nonce),(0,o.XD)(this.maxPriorityFeePerGas),(0,o.XD)(this.maxFeePerGas),(0,o.XD)(this.gasLimit),void 0!==this.to?this.to.bytes:new Uint8Array(0),(0,o.XD)(this.value),this.data,this.accessList,(0,o.XD)(this.maxFeePerBlobGas),this.blobVersionedHashes,void 0!==this.v?(0,o.XD)(this.v):new Uint8Array(0),void 0!==this.r?(0,o.XD)(this.r):new Uint8Array(0),void 0!==this.s?(0,o.XD)(this.s):new Uint8Array(0)]}serialize(){return E(this)}serializeNetworkWrapper(){if(void 0===this.blobs||void 0===this.kzgCommitments||void 0===this.kzgProofs)throw Error("cannot serialize network wrapper without blobs, KZG commitments and KZG proofs provided");return E(this,[this.raw(),this.blobs,this.kzgCommitments,this.kzgProofs])}getMessageToSign(){return E(this,this.raw().slice(0,11))}getHashedMessageToSign(){return p(this)}hash(){return f(this)}getMessageToVerifySignature(){return this.getHashedMessageToSign()}getSenderPublicKey(){return b(this)}static networkWrapperToJson(t,e){let i=this.fromSerializedBlobTxNetworkWrapper(t,e),r=h.getAccessListJSON(i.accessList);return{...i.toJSON(),chainId:(0,o.Z4)(i.chainId),maxPriorityFeePerGas:(0,o.Z4)(i.maxPriorityFeePerGas),maxFeePerGas:(0,o.Z4)(i.maxFeePerGas),accessList:r,maxFeePerBlobGas:(0,o.Z4)(i.maxFeePerBlobGas),blobVersionedHashes:i.blobVersionedHashes.map(t=>(0,o.ci)(t)),blobs:i.blobs.map(t=>(0,o.ci)(t)),kzgCommitments:i.kzgCommitments.map(t=>(0,o.ci)(t)),kzgProofs:i.kzgProofs.map(t=>(0,o.ci)(t))}}toJSON(){let t=h.getAccessListJSON(this.accessList);return{...super.toJSON(),chainId:(0,o.Z4)(this.chainId),maxPriorityFeePerGas:(0,o.Z4)(this.maxPriorityFeePerGas),maxFeePerGas:(0,o.Z4)(this.maxFeePerGas),accessList:t,maxFeePerBlobGas:(0,o.Z4)(this.maxFeePerBlobGas),blobVersionedHashes:this.blobVersionedHashes.map(t=>(0,o.ci)(t))}}addSignature(t,e,i,r=!1){e=(0,o.O0)(e),i=(0,o.O0)(i);let s={...this.txOptions,common:this.common};return z.fromTxData({chainId:this.chainId,nonce:this.nonce,maxPriorityFeePerGas:this.maxPriorityFeePerGas,maxFeePerGas:this.maxFeePerGas,gasLimit:this.gasLimit,to:this.to,value:this.value,data:this.data,accessList:this.accessList,v:r?t-o.Ym:t,r:(0,o.v3)(e),s:(0,o.v3)(i),maxFeePerBlobGas:this.maxFeePerBlobGas,blobVersionedHashes:this.blobVersionedHashes,blobs:this.blobs,kzgCommitments:this.kzgCommitments,kzgProofs:this.kzgProofs},s)}errorStr(){return this._getSharedErrorPostfix()+` maxFeePerGas=${this.maxFeePerGas} maxPriorityFeePerGas=${this.maxPriorityFeePerGas}`}_errorMsg(t){return v(this,t)}numBlobs(){return this.blobVersionedHashes.length}}class S extends d{constructor(t,e={}){super({...t,type:s.EOACodeEIP7702},e);let{chainId:i,accessList:r,authorizationList:a,maxFeePerGas:n,maxPriorityFeePerGas:m}=t;if(this.common=this._getCommon(e.common,i),this.chainId=this.common.chainId(),!this.common.isActivatedEIP(7702))throw Error("EIP-7702 not enabled on Common");this.activeCapabilities=this.activeCapabilities.concat([1559,2718,2930,7702]);let l=h.getAccessListData(r??[]);this.accessList=l.accessList,this.AccessListJSON=l.AccessListJSON,h.verifyAccessList(this.accessList);let g=c.getAuthorizationListData(a??[]);if(this.authorizationList=g.authorizationList,this.AuthorizationListJSON=g.AuthorizationListJSON,c.verifyAuthorizationList(this.authorizationList),this.maxFeePerGas=(0,o.v3)((0,o.O0)(n)),this.maxPriorityFeePerGas=(0,o.v3)((0,o.O0)(m)),this._validateCannotExceedMaxInteger({maxFeePerGas:this.maxFeePerGas,maxPriorityFeePerGas:this.maxPriorityFeePerGas}),d._validateNotArray(t),this.gasLimit*this.maxFeePerGas>o.E2)throw Error(this._errorMsg("gasLimit * maxFeePerGas cannot exceed MAX_INTEGER (2^256-1)"));if(this.maxFeePerGas<this.maxPriorityFeePerGas)throw Error(this._errorMsg("maxFeePerGas cannot be less than maxPriorityFeePerGas (The total must be the larger of the two)"));I(this),y(this),(e?.freeze??!0)&&Object.freeze(this)}static fromTxData(t,e={}){return new S(t,e)}static fromSerializedTx(t,e={}){if(!1===(0,o.hD)(t.subarray(0,1),m(s.EOACodeEIP7702)))throw Error(`Invalid serialized tx input: not an EIP-7702 transaction (wrong tx type, expected: ${s.EOACodeEIP7702}, received: ${(0,o.ci)(t.subarray(0,1))}`);let i=a.yH.decode(t.subarray(1));if(!Array.isArray(i))throw Error("Invalid serialized tx input: must be array");return S.fromValuesArray(i,e)}static fromValuesArray(t,e={}){if(10!==t.length&&13!==t.length)throw Error("Invalid EIP-7702 transaction. Only expecting 10 values (for unsigned tx) or 13 values (for signed tx).");let[i,r,s,a,n,h,c,m,d,l,g,u,v]=t;return this._validateNotArray({chainId:i,v:g}),(0,o.jY)({nonce:r,maxPriorityFeePerGas:s,maxFeePerGas:a,gasLimit:n,value:c,v:g,r:u,s:v}),new S({chainId:(0,o.v3)(i),nonce:r,maxPriorityFeePerGas:s,maxFeePerGas:a,gasLimit:n,to:h,value:c,data:m,accessList:d??[],authorizationList:l??[],v:void 0!==g?(0,o.v3)(g):void 0,r:u,s:v},e)}getDataFee(){return function(t){let e=BigInt(h.getDataFeeEIP2930(t.accessList,t.common)),i=BigInt(t.authorizationList.length*Number(t.common.param("gasPrices","perAuthBaseCost")));return P(t,e+i)}(this)}getEffectivePriorityFee(t){return g(this,t)}getUpfrontCost(t=o.N$){return l(this,t)}raw(){return[(0,o.XD)(this.chainId),(0,o.XD)(this.nonce),(0,o.XD)(this.maxPriorityFeePerGas),(0,o.XD)(this.maxFeePerGas),(0,o.XD)(this.gasLimit),void 0!==this.to?this.to.bytes:new Uint8Array(0),(0,o.XD)(this.value),this.data,this.accessList,this.authorizationList,void 0!==this.v?(0,o.XD)(this.v):new Uint8Array(0),void 0!==this.r?(0,o.XD)(this.r):new Uint8Array(0),void 0!==this.s?(0,o.XD)(this.s):new Uint8Array(0)]}serialize(){return E(this)}getMessageToSign(){return E(this,this.raw().slice(0,10))}getHashedMessageToSign(){return p(this)}hash(){return f(this)}getMessageToVerifySignature(){return this.getHashedMessageToSign()}getSenderPublicKey(){return b(this)}addSignature(t,e,i,r=!1){e=(0,o.O0)(e),i=(0,o.O0)(i);let s={...this.txOptions,common:this.common};return S.fromTxData({chainId:this.chainId,nonce:this.nonce,maxPriorityFeePerGas:this.maxPriorityFeePerGas,maxFeePerGas:this.maxFeePerGas,gasLimit:this.gasLimit,to:this.to,value:this.value,data:this.data,accessList:this.accessList,authorizationList:this.authorizationList,v:r?t-o.Ym:t,r:(0,o.v3)(e),s:(0,o.v3)(i)},s)}toJSON(){let t=h.getAccessListJSON(this.accessList);return{...super.toJSON(),chainId:(0,o.Z4)(this.chainId),maxPriorityFeePerGas:(0,o.Z4)(this.maxPriorityFeePerGas),maxFeePerGas:(0,o.Z4)(this.maxFeePerGas),accessList:t,authorizationList:this.AuthorizationListJSON}}errorStr(){return this._getSharedErrorPostfix()+` maxFeePerGas=${this.maxFeePerGas} maxPriorityFeePerGas=${this.maxPriorityFeePerGas}`}_errorMsg(t){return v(this,t)}}function C(t,e){let i=Number(t),r=2*Number(e);return i===r+35||i===r+36}class G extends d{constructor(t,e={}){if(super({...t,type:s.Legacy},e),this.common=this._validateTxV(this.v,e.common),this.keccakFunction=this.common.customCrypto.keccak256??u.wn,this.gasPrice=(0,o.v3)((0,o.O0)(t.gasPrice)),this.gasPrice*this.gasLimit>o.E2)throw Error(this._errorMsg("gas limit * gasPrice cannot exceed MAX_INTEGER (2^256-1)"));this._validateCannotExceedMaxInteger({gasPrice:this.gasPrice}),d._validateNotArray(t),this.common.gteHardfork("spuriousDragon")&&(this.isSigned()?C(this.v,this.common.chainId())&&this.activeCapabilities.push(r.EIP155ReplayProtection):this.activeCapabilities.push(r.EIP155ReplayProtection)),(e?.freeze??!0)&&Object.freeze(this)}static fromTxData(t,e={}){return new G(t,e)}static fromSerializedTx(t,e={}){let i=a.yH.decode(t);if(!Array.isArray(i))throw Error("Invalid serialized tx input. Must be array");return this.fromValuesArray(i,e)}static fromValuesArray(t,e={}){if(6!==t.length&&9!==t.length)throw Error("Invalid transaction. Only expecting 6 values (for unsigned tx) or 9 values (for signed tx).");let[i,r,s,a,n,h,c,m,d]=t;return(0,o.jY)({nonce:i,gasPrice:r,gasLimit:s,value:n,v:c,r:m,s:d}),new G({nonce:i,gasPrice:r,gasLimit:s,to:a,value:n,data:h,v:c,r:m,s:d},e)}getEffectivePriorityFee(t){return x(this.gasPrice,t)}raw(){return[(0,o.XD)(this.nonce),(0,o.XD)(this.gasPrice),(0,o.XD)(this.gasLimit),void 0!==this.to?this.to.bytes:new Uint8Array(0),(0,o.XD)(this.value),this.data,void 0!==this.v?(0,o.XD)(this.v):new Uint8Array(0),void 0!==this.r?(0,o.XD)(this.r):new Uint8Array(0),void 0!==this.s?(0,o.XD)(this.s):new Uint8Array(0)]}serialize(){return a.yH.encode(this.raw())}getMessageToSign(){let t=[(0,o.XD)(this.nonce),(0,o.XD)(this.gasPrice),(0,o.XD)(this.gasLimit),void 0!==this.to?this.to.bytes:new Uint8Array(0),(0,o.XD)(this.value),this.data];return this.supports(r.EIP155ReplayProtection)&&(t.push((0,o.XD)(this.common.chainId())),t.push((0,o._K)((0,o.O0)(0))),t.push((0,o._K)((0,o.O0)(0)))),t}getHashedMessageToSign(){let t=this.getMessageToSign();return this.keccakFunction(a.yH.encode(t))}getDataFee(){return P(this)}getUpfrontCost(){return this.gasLimit*this.gasPrice+this.value}hash(){return f(this)}getMessageToVerifySignature(){if(!this.isSigned())throw Error(this._errorMsg("This transaction is not signed"));return this.getHashedMessageToSign()}getSenderPublicKey(){return b(this)}addSignature(t,e,i,s=!1){e=(0,o.O0)(e),i=(0,o.O0)(i),s&&this.supports(r.EIP155ReplayProtection)&&(t+=this.common.chainId()*o.m5+o.Be);let a={...this.txOptions,common:this.common};return G.fromTxData({nonce:this.nonce,gasPrice:this.gasPrice,gasLimit:this.gasLimit,to:this.to,value:this.value,data:this.data,v:t,r:(0,o.v3)(e),s:(0,o.v3)(i)},a)}toJSON(){return{...super.toJSON(),gasPrice:(0,o.Z4)(this.gasPrice)}}_validateTxV(t,e){let i;let r=void 0!==t?Number(t):void 0;if(void 0!==r&&r<37&&27!==r&&28!==r)throw Error(`Legacy txs need either v = 27/28 or v >= 37 (EIP-155 replay protection), got v = ${r}`);if(void 0!==r&&0!==r&&(!e||e.gteHardfork("spuriousDragon"))&&27!==r&&28!==r){if(e){if(!C(BigInt(r),e.chainId()))throw Error(`Incompatible EIP155-based V ${r} and chain id ${e.chainId()}. See the Common parameter of the Transaction constructor to set the chain id.`)}else{let t;t=(r-35)%2==0?35:36,i=BigInt(r-t)/o.m5}}return this._getCommon(e,i)}errorStr(){return this._getSharedErrorPostfix()+` gasPrice=${this.gasPrice}`}_errorMsg(t){return v(this,t)}}let D=t=>{let e=Object.assign({},t);return e.gasLimit=(0,o.Fy)(e.gasLimit??e.gas,o.qT.BigInt),e.data=void 0===e.data?e.input:e.data,e.gasPrice=void 0!==e.gasPrice?BigInt(e.gasPrice):void 0,e.value=void 0!==e.value?BigInt(e.value):void 0,e.to=null!==e.to&&void 0!==e.to?(0,o.V_)((0,o.O0)(e.to),20):null,e.v="0x0"===e.v?"0x":e.v,e.r="0x0"===e.r?"0x":e.r,e.s="0x0"===e.s?"0x":e.s,("0x"!==e.v||"0x"!==e.r||"0x"!==e.s)&&(e.v=(0,o.Fy)(e.v,o.qT.BigInt)),e};class O{constructor(){}static fromTxData(t,e={}){if(!("type"in t)||void 0===t.type||Number((0,o.v3)((0,o.O0)(t.type)))===s.Legacy)return G.fromTxData(t,e);if(Number((0,o.v3)((0,o.O0)(t.type)))===s.AccessListEIP2930)return F.fromTxData(t,e);if(Number((0,o.v3)((0,o.O0)(t.type)))===s.FeeMarketEIP1559)return A.fromTxData(t,e);if(Number((0,o.v3)((0,o.O0)(t.type)))===s.BlobEIP4844)return z.fromTxData(t,e);if(Number((0,o.v3)((0,o.O0)(t.type)))===s.EOACodeEIP7702)return S.fromTxData(t,e);throw Error(`Tx instantiation with type ${t?.type} not supported`)}static fromSerializedData(t,e={}){if(!(t[0]<=127))return G.fromSerializedTx(t,e);switch(t[0]){case s.AccessListEIP2930:return F.fromSerializedTx(t,e);case s.FeeMarketEIP1559:return A.fromSerializedTx(t,e);case s.BlobEIP4844:return z.fromSerializedTx(t,e);case s.EOACodeEIP7702:return S.fromSerializedTx(t,e);default:throw Error(`TypedTransaction with ID ${t[0]} unknown`)}}static fromBlockBodyData(t,e={}){if(t instanceof Uint8Array)return this.fromSerializedData(t,e);if(Array.isArray(t))return G.fromValuesArray(t,e);throw Error("Cannot decode transaction: unknown type input")}static async fromJsonRpcProvider(t,e,i){let r=(0,o.VH)(t),s=await (0,o.YZ)(r,{method:"eth_getTransactionByHash",params:[e]});if(null===s)throw Error("No data returned from provider");return O.fromRPC(s,i)}static async fromRPC(t,e={}){return O.fromTxData(D(t),e)}}}};