import { AccountId } from 'caip';
const DID_LD_JSON = 'application/did+ld+json';
const DID_JSON = 'application/did+json';
function toDidDoc(did, blockchainAccountId) {
    const { namespace } = AccountId.parse(blockchainAccountId)
        .chainId;
    const vmId = did + '#blockchainAccountId';
    const doc = {
        '@context': [
            'https://www.w3.org/ns/did/v1',
            {
                blockchainAccountId: 'https://w3id.org/security#blockchainAccountId',
                EcdsaSecp256k1RecoveryMethod2020: 'https://identity.foundation/EcdsaSecp256k1RecoverySignature2020#EcdsaSecp256k1RecoveryMethod2020',
            },
        ],
        id: did,
        verificationMethod: [
            {
                id: vmId,
                type: 'EcdsaSecp256k1RecoveryMethod2020',
                controller: did,
                blockchainAccountId,
            },
        ],
        authentication: [vmId],
        assertionMethod: [vmId],
    };
    return doc;
}
export function getAAResolver() {
    return {
        aa: async (did, parsed, r, options) => {
            console.info(">>>>>>>> inside aa resolver: did: ", did);
            const contentType = options.accept || DID_JSON;
            const response = {
                didResolutionMetadata: { contentType },
                didDocument: null,
                didDocumentMetadata: {},
            };
            try {
                const doc = toDidDoc(did, parsed.id);
                if (contentType === DID_LD_JSON) {
                    response.didDocument = doc;
                }
                else if (contentType === DID_JSON) {
                    delete doc['@context'];
                    response.didDocument = doc;
                }
                else {
                    delete response.didResolutionMetadata.contentType;
                    response.didResolutionMetadata.error = 'representationNotSupported';
                }
            }
            catch (e) {
                response.didResolutionMetadata.error = 'invalidDid';
                response.didResolutionMetadata.message = e.message;
            }
            console.info(">>>>>>>> inside aa resolver: response: ", JSON.stringify(response));
            return response;
        },
    };
}
//# sourceMappingURL=AAResolver.js.map